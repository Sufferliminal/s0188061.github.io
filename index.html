import React, { useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";

export default function MinimalPostcard() {
  const [opened, setOpened] = useState(false);
  const [particles, setParticles] = useState([]);

  useEffect(() => {
    let timer;
    if (opened) {
      timer = setInterval(() => {
        const emojis = ["‚ù§Ô∏è", "‚ú®", "üòä", "üí´", "üíï", "üéâ", "üå∏", "üåü"];
        const count = Math.floor(Math.random() * 4) + 4; // 4-7 —á–∞—Å—Ç–∏—Ü
        const newOnes = Array.from({ length: count }).map(() => ({
          id: Math.random().toString(36).slice(2),
          emoji: emojis[Math.floor(Math.random() * emojis.length)],
          angle: Math.random() * 360,
          size: 18 + Math.random() * 22,
          duration: 8000 + Math.random() * 4000 // –µ—â—ë –¥–æ–ª—å—à–µ (8-12 —Å–µ–∫—É–Ω–¥)
        }));
        setParticles((p) => [...p, ...newOnes]);
        setTimeout(() => {
          setParticles((p) => p.slice(newOnes.length));
        }, 12000);
      }, 600);
    }
    return () => clearInterval(timer);
  }, [opened]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100 p-6 overflow-hidden relative">
      <div className="relative w-full max-w-xl flex flex-col items-center text-center gap-6">

        {/* –ß–∞—Å—Ç–∏—Ü—ã */}
        <div className="pointer-events-none fixed inset-0 flex items-center justify-center overflow-visible z-0">
          {particles.map((part) => (
            <span
              key={part.id}
              className="absolute select-none"
              style={{
                fontSize: part.size,
                animation: `burst${part.id} ${part.duration}ms ease-out forwards`,
              }}
            >
              {part.emoji}
              <style>{`
                @keyframes burst${part.id} {
                  0% { transform: translate(0,0) scale(1); opacity: 1; }
                  100% {
                    transform: translate(${Math.cos(part.angle * Math.PI/180) * 360}px, ${Math.sin(part.angle * Math.PI/180) * 360}px) scale(0.8);
                    opacity: 0;
                  }
                }
              `}</style>
            </span>
          ))}
        </div>

        {/* –ö–æ–Ω–≤–µ—Ä—Ç */}
        <motion.button
          onClick={() => setOpened((s) => !s)}
          aria-pressed={opened}
          className="relative w-64 h-44 bg-gradient-to-br from-pink-200 via-rose-200 to-purple-200 rounded-2xl shadow-lg border border-pink-300 flex items-center justify-center focus:outline-none z-10"
          initial={false}
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.97 }}
        >
          <motion.div
            className="absolute inset-0 rounded-2xl"
            animate={{ boxShadow: opened ? "0 12px 36px rgba(0,0,0,0.15)" : "0 8px 22px rgba(0,0,0,0.08)" }}
          />

          <svg viewBox="0 0 200 140" width="240" height="168" className="z-10">
            <rect x="0" y="20" width="200" height="110" rx="12" fill="#fffafc" stroke="#fbcfe8" />
            <rect x="12" y="26" width="176" height="88" rx="8" fill="#fff" />
            <g stroke="#fbcfe8" strokeWidth="1">
              <line x1="12" y1="60" x2="188" y2="60" />
            </g>

            <g transform="translate(100,20)">
              <motion.g
                transformOrigin="0 0"
                initial={{ rotateX: 0 }}
                animate={{ rotateX: opened ? -180 : 0 }}
                transition={{ duration: 0.6 }}
                style={{ transformStyle: "preserve-3d" }}
              >
                <path
                  d="M-100 0 L0 60 L100 0 L0 -48 Z"
                  fill="#ffe4e6"
                  stroke="#f9a8d4"
                  strokeWidth="1"
                />
              </motion.g>
            </g>

            <g transform="translate(160,100)">
              <circle cx="0" cy="0" r="14" fill="#ffe4e6" stroke="#f9a8d4" />
              <text x="-6" y="6" fontSize="16">üíñ</text>
            </g>
          </svg>
        </motion.button>

        {/* –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞ */}
        <AnimatePresence>
          {opened && (
            <motion.div
              key="message"
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              exit={{ opacity: 0, scale: 0.9 }}
              transition={{ duration: 0.5 }}
              className="fixed inset-0 flex items-center justify-center p-6 z-20 bg-black/20"
              onClick={() => setOpened(false)}
            >
              <div
                className="max-w-md bg-white/90 backdrop-blur-md rounded-2xl p-8 shadow-2xl border border-pink-200 text-center"
                onClick={(e) => e.stopPropagation()}
              >
                <h2 className="text-3xl font-bold mb-3 bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent">–° –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–º, –º–æ—è –¥–æ—Ä–æ–≥–∞—è!</h2>
                <p className="text-gray-700 mb-4 leading-relaxed">
                  –ü—É—Å—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–Ω–æ—Å–∏—Ç —Ä–∞–¥–æ—Å—Ç—å –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ. –ñ–µ–ª–∞—é –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å—á–∞—Å—Ç—å—è, –∫—Ä–µ–ø–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –∏ –±–æ–ª—å—à–∏—Ö —Å–≤–µ—Ä—à–µ–Ω–∏–π!
                </p>
                <ul className="text-gray-700 text-sm space-y-2">
                  <li>üå∏ –£–ª—ã–±–æ–∫ –∏ —Ç–µ–ø–ª–∞.</li>
                  <li>üåü –£–¥–∞—á–∏ –≤–æ –≤—Å–µ—Ö –¥–µ–ª–∞—Ö.</li>
                  <li>üíñ –õ—é–±–≤–∏ –∏ –≥–∞—Ä–º–æ–Ω–∏–∏.</li>
                </ul>
                <div className="mt-5 text-right">
                  <span className="text-sm text-pink-600">–° –ª—é–±–æ–≤—å—é, —Ç–≤–æ–π –¥—Ä—É–≥ üíå</span>
                </div>
              </div>
            </motion.div>
          )}
        </AnimatePresence>

        <p className="text-xs text-gray-500">–ù–∞–∂–º–∏ –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å ‚ú®</p>
      </div>
    </div>
  );
}
